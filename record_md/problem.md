# 问题记录文档
## 问题描述
    目前，训练好的神经网络在预测时，结果一直在一个很小的范围内波动（输出收敛到一个常数值），无法得到预期的结果。
    神经网络输出几乎不随输入变化，导致预测无法反映实际物理现象。
    
    示例图：
    ![validation_predictions](C:\0_code\new_osp\models\validation_predictions.png)

## 问题分析
    通过系统性排查，我们尝试了多种方法解决神经网络输出恒定值的问题，但仍未取得突破：

### 1. 模型架构问题
    我们使用的是两层隐藏层的前馈神经网络结构（64-32-1），这种结构对于物理仿真问题通常应该足够，
    但可能在我们的特定问题上表达能力不足或不适合。网络可能陷入了不良局部最优解或梯度消失状态。

### 2. 损失函数配置问题
    我们使用了自定义的物理信息损失函数(PINN)，尝试引入物理约束来提高模型性能。
    在出现问题之后，我们更换了简单Huber损失函数，但是问题仍然存在，说明问题可能出在其他地方。
    物理约束权重的设置(PINN_PHYSICS_WEIGHT=0.5)可能不足以引导模型学习到正确的解。

### 3. 激活函数配置问题
    我们在隐藏层使用了tanh激活函数，在输出层使用了sigmoid激活函数。
    尝试了其他激活函数组合(如ReLU+线性输出)，但是问题仍然存在。
    这可能表明激活函数选择不是问题的核心所在，或者需要更加复杂的激活函数设计。

### 4. 权重初始值配置问题
    原始模型使用了标准初始化方法(he_normal, glorot_uniform)，为了解决恒定输出问题，
    我们尝试了更大的初始化值(mean=0.201, stddev=0.05)，期望通过更大的初始权重值来避免模型收敛到恒定输出。
    尽管调整了这些参数，但模型训练后的结果仍然是输出恒定值，未能解决问题。
    ![weight_distribution](C:\0_code\new_osp\weight_plots\epoch_024_weights_distribution.png)

### 5. 优化器配置问题
    我们先使用了SGD优化器，后来尝试了自定义的遗传算法优化器，希望通过非梯度方法来跳出局部最优。
    遗传算法优化器模拟了生物进化过程中的选择、交叉、变异机制，理论上有助于跳出局部最优解。
    但两种优化方法都未能解决输出恒定值的问题，可能表明问题更加复杂或深层次。

### 6. 学习率配置问题
    测试了不同的学习率设置和学习率调度策略，但效果仍不理想。
    过大的学习率可能导致收敛不稳定，过小的学习率可能使模型无法跳出局部最优。

### 7. 数据处理问题
    我们对数据进行了归一化处理(NORMALIZE_DATA=True)，并测试了不同的数据分割策略，
    但输出显示数据读取和处理正确，预处理方式似乎不是问题关键。
    然而，数据的分布特性或噪声可能对神经网络的学习有重大影响。

### 8. 物理先验知识整合问题
    尽管使用了PINN方法尝试整合物理约束，但物理约束的表达方式和权重可能不够理想，
    未能有效引导模型学习到正确的物理规律。

## 可能的根本原因
    综合分析，神经网络输出恒定值可能的根本原因：
    
    1. **问题本质复杂性**：模拟的物理系统可能具有高度非线性和复杂边界条件，超出了所选神经网络架构的表达能力。
    
    2. **训练过程困境**：神经网络可能陷入了严重的局部最优解或鞍点，导致所有输入的输出几乎相同。
    
    3. **物理约束不足**：物理信息神经网络(PINN)的约束设计可能不够完善，未能有效约束模型行为。
    
    4. **数据与模型不匹配**：训练数据可能与所选模型架构不兼容，或者数据中存在神经网络难以捕捉的模式。

## 解决方案探索
    考虑到神经网络方法面临的困难，我们可以探索以下非神经网络的替代方法：

### 1. 传统数值方法
    * **有限差分法(FDM)**：直接基于微分方程的数值近似求解，对于已知物理模型的问题更为可靠。
    * **有限元方法(FEM)**：特别适用于复杂几何形状和边界条件的问题，如光学薄膜的模拟。
    * **边界元方法(BEM)**：适合于线性问题，计算效率较高。

### 2. 半解析方法
    * **特征函数展开**：利用物理问题的特征函数对解进行展开，可以提高计算精度。
    * **传输矩阵方法**：特别适用于光学薄膜等层状结构的反射率和透射率计算。

### 3. 优化算法方法
    * **遗传算法**：不局限于神经网络框架，直接用于寻找满足物理约束的解。
    * **粒子群优化**：通过模拟群体行为搜索解空间，可能找到神经网络错过的解。
    * **模拟退火算法**：适用于跳出局部最优解的全局优化问题。

### 4. 混合方法
    * **神经网络+解析解**：将已知的物理解析解作为基础，神经网络只学习残差部分。
    * **数值方法+机器学习**：使用机器学习加速传统数值方法的某些计算步骤。
    * **物理模型驱动的回归**：基于物理方程构建特征，然后使用较简单的统计模型（如多项式回归、支持向量机等）进行拟合。

### 5. 专业仿真软件
    * 对于光学薄膜问题，可考虑使用专业的光学仿真软件如COMSOL、Lumerical FDTD、Essential Macleod等，
      这些软件内置了求解光学薄膜传输问题的高效算法。

## 下一步行动计划
    1. **探索传输矩阵方法**：作为处理多层薄膜光学特性的有效方法，实现一个基本的传输矩阵求解器。
    
    2. **尝试直接优化方法**：使用遗传算法或粒子群优化直接寻找满足物理约束的解，不依赖神经网络架构。
    
    3. **简化问题复杂度**：首先尝试解决简化版问题，验证方法可行性后再扩展到完整问题。
    
    4. **建立基准模型**：使用传统数值方法建立基准解，作为评估其他方法性能的参考。
    
    5. **重新审视数据**：深入分析数据分布特性，可能需要更多的特征工程或预处理。